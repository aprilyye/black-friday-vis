<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    body {
      font-family: "Open Sans", sans-serif;
      font-size: 14px;
    }

    h1 {
      font-weight: normal;
      font-size: 20px;
      text-align: center;
      margin-top: 40px
    }

    #authors {
      text-align: center;
      font-size: 14px;
      margin-top: 5px;
    }

    div {
      margin: 30px;
    }

    .description {
      width: 650px;
      margin: auto;
      margin-top: 50px;
      text-align: center;
      border: solid 1px;
      padding: 30px;

    }
  </style>
</head>

<body>
  <h1>Black Friday Consumer Trends </h1>
  <p id="authors">Kenny Zhou (kz68), April Ye (yy459), Kelly Yu (ky356) </p>
  <div class="description">
    The visualization below illustrates the behaviors of consumers on Black Friday
    in a retail store. It compares the consumer trends between different age
    groups and genders by analyzing the amount spent on purchases on this popular
    shopping day in the United States.
  </div>
  <p>
    <svg width="800" height="500" id="vis1">
    </svg>
  </p>
  <script>
    var blackFridayData1;
    var blackFridayData2
    d3.csv("BlackFriday.csv").then(function (data1) {
      d3.csv("blackfriday2.csv").then(function (data2) {
        blackFridayData1 = data1;
        blackFridayData2 = data2;
        console.log("data =", blackFridayData1); // confirm data is successfully loaded
        console.log("data2=", blackFridayData2);
        var females = males = 0;
        // females age group counters initialized
        var f0to17 = f18to25 = f26to35 = f36to45 = f46to50 = f51to55 = f55andup = 0;
        var f0to17Purchase = f18to25Purchase = f26to35Purchase = f36to45Purchase
          = f46to50Purchase = f51to55Purchase = f55andupPurchase = 0;
        // male age group counters initialized
        var m0to17 = m18to25 = m26to35 = m36to45 = m46to50 = m51to55 = m55andup = 0;
        var m0to17Purchase = m18to25Purchase = m26to35Purchase = m36to45Purchase
          = m46to50Purchase = m51to55Purchase = m55andupPurchase = 0;
        blackFridayData1.forEach(d => {
          if (d['Gender'] == "F") {
            females++;
            if (d['Age'] == "0-17") {
              f0to17++;
              f0to17Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "18-25") {
              f18to25++;
              f18to25Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "26-35") {
              f26to35++;
              f26to35Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "36-45") {
              f36to45++;
              f36to45Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "46-50") {
              f46to50++;
              f46to50Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "51-55") {
              f51to55++;
              f51to55Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "55+") {
              f55andup++;
              f55andupPurchase += parseInt(d['Purchase']);
            }
          } else if (d['Gender'] == "M") {
            males++;
            if (d['Age'] == "0-17") {
              m0to17++;
              m0to17Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "18-25") {
              m18to25++;
              m18to25Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "26-35") {
              m26to35++;
              m26to35Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "36-45") {
              m36to45++;
              m36to45Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "46-50") {
              m46to50++;
              m46to50Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "51-55") {
              m51to55++;
              m51to55Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "55+") {
              m55andup++;
              m55andupPurchase += parseInt(d['Purchase']);
            }
          }

        });

        // calculating percentages
        var f0to17Percent = (f0to17 / females).toFixed(2);
        var f18to25Percent = (f18to25 / females).toFixed(2);
        var f26to35Percent = (f26to35 / females).toFixed(2);
        var f36to45Percent = (f36to45 / females).toFixed(2);
        var f46to50Percent = (f46to50 / females).toFixed(2);
        var f51to55Percent = (f51to55 / females).toFixed(2);
        var f55andupPercent = (f55andup / females).toFixed(2);

        var m0to17Percent = (m0to17 / males).toFixed(2);
        var m18to25Percent = (m18to25 / males).toFixed(2);
        var m26to35Percent = (m26to35 / males).toFixed(2);
        var m36to45Percent = (m36to45 / males).toFixed(2);
        var m46to50Percent = (m46to50 / males).toFixed(2);
        var m51to55Percent = (m51to55 / males).toFixed(2);
        var m55andupPercent = (m55andup / males).toFixed(2);


        // outputting results
        console.log("females =", females);
        console.log("females17 =", f0to17, f0to17Percent, f0to17Purchase);
        console.log("females18 =", f18to25, f18to25Percent, f18to25Purchase);
        console.log("females26 =", f26to35, f26to35Percent, f26to35Purchase);
        console.log("females36 =", f36to45, f36to45Percent, f36to45Purchase);
        console.log("females46 =", f46to50, f46to50Percent, f46to50Purchase);
        console.log("females51 =", f51to55, f51to55Percent, f51to55Purchase);
        console.log("females55 =", f55andup, f55andupPercent, f55andupPurchase);

        console.log("males =", males);
        console.log("males17 =", m0to17, m0to17Percent, m0to17Purchase);
        console.log("males18 =", m18to25, m18to25Percent, m18to25Purchase);
        console.log("males26 =", m26to35, m26to35Percent, m26to35Purchase);
        console.log("males36 =", m36to45, m36to45Percent, m36to45Purchase);
        console.log("males46 =", m46to50, m46to50Percent, m46to50Purchase);
        console.log("males51 =", m51to55, m51to55Percent, m51to55Purchase);
        console.log("males55 =", m55andup, m55andupPercent, m55andupPurchase);

        // Building the grouped bar graph 
        // svg backbone
        let svg = d3.select("svg#vis1");
        let width = svg.attr("width");
        let height = svg.attr("height");
        let margin = { top: 50, right: 50, bottom: 50, left: 50 };
        let chartWidth = width - margin.left - margin.right;
        let chartHeight = height - margin.top - margin.bottom;

        // // Scales
        // let ageGroupScale = d3.scalePoint()
        //   .domain(["0-17", "18-25", "26-35", "36-45", "46-50", "51-55", "55+"])
        //   .range([20, chartWidth]);
        // let maxPurchase = d3.max([f0to17Purchase, f18to25Purchase, f26to35Purchase,
        //   f36to45Purchase, f46to50Purchase, f51to55Purchase, f55andupPurchase,
        //   m0to17Purchase, m18to25Purchase, m26to35Purchase, m36to45Purchase,
        //   m46to50Purchase, m51to55Purchase, m55andupPurchase]);
        // let purchasesScale = d3.scaleLinear()
        //   .domain([0, maxPurchase])
        //   .range([chartHeight, 0]);

        // // X and Y axes
        // let xAxis = d3.axisBottom()
        //   .scale(ageGroupScale);
        // let yAxis = d3.axisLeft()
        //   .ticks(10, d3.format("$"))
        //   .scale(purchasesScale);
        // svg.append("g")
        //   .attr("transform", "translate(" + margin.left + "," + (margin.top + chartHeight) + ")")
        //   .call(xAxis)
        //   .style("font-size", "8");
        // svg.append("g")
        //   .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        //   .call(yAxis)
        //   .style("font-size", "8");

      })
    })
      .catch((err) => {
        throw new Error("Something went wrong", err);
      });
  </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    body {
      font-family: "Open Sans", sans-serif;
      font-size: 14px;
      color: white;
      background-color: #141619;
    }

    h1 {
      font-weight: normal;
      font-size: 20px;
      text-align: center;
      margin-top: 40px
    }

    #authors {
      text-align: center;
      font-size: 14px;
      margin-top: 5px;
    }

    div {
      margin: 30px;
    }

    .description {
      width: 650px;
      margin: auto;
      margin-top: 50px;
      text-align: center;
      border: solid 1px;
      padding: 30px;
    }

    #vis2 {
      display: block;
      border: solid 2px black;
      margin: auto;
      margin-top: 200px;
    }

    .title {
      font-size: 20px;
    }
  </style>
</head>

<body>
  <h1>Black Friday Consumer Trends </h1>
  <p id="authors">Kenny Zhou (kz68), April Ye (yy459), Kelly Yu (ky356) </p>
  <div class="description">
    The visualization below illustrates the behaviors of consumers on Black Friday
    in a retail store. It compares the consumer trends between different age
    groups and genders by analyzing the amount spent on purchases on this popular
    shopping day in the United States.
  </div>
  <p>
    <!-- girl svg -->
    <svg width="400px" height="536px" viewBox="0 0 156 268" id="pplgirl">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
      </g>
    </svg>
    <!-- girl scale -->
    <svg width="110px" height="610px" viewBox="0 0 156 268" id="gScale">
      <g stroke="none" stroke-width="1" fill="none">
      </g>
    </svg>
    <!-- guy svg -->
    <svg width="400px" height="536px" viewBox="0 0 156 258" id="pplboy">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
      </g>
    </svg>
    <svg width="1500" height="500" id="vis1">

    </svg>
  </p>
  <div>
    <svg width="1000" height="700" id="vis2">
    </svg>
  </div>
  <script>
    var blackFridayData1;
    var blackFridayData2
    d3.csv("BlackFriday.csv").then(function (data1) {
      d3.csv("blackfriday2.csv").then(function (data2) {
        blackFridayData1 = data1;
        blackFridayData2 = data2;
        console.log("data =", blackFridayData1); // confirm data is successfully loaded
        console.log("data2=", blackFridayData2);
        var females = males = 0;
        // females age group counters initialized
        var f0to17 = f18to25 = f26to35 = f36to45 = f46to50 = f51to55 = f55andup = 0;
        var f0to17Purchase = f18to25Purchase = f26to35Purchase = f36to45Purchase
          = f46to50Purchase = f51to55Purchase = f55andupPurchase = 0;
        // male age group counters initialized
        var m0to17 = m18to25 = m26to35 = m36to45 = m46to50 = m51to55 = m55andup = 0;
        var m0to17Purchase = m18to25Purchase = m26to35Purchase = m36to45Purchase
          = m46to50Purchase = m51to55Purchase = m55andupPurchase = 0;
        blackFridayData1.forEach(d => {
          if (d['Gender'] == "F") {
            females++;
            if (d['Age'] == "0-17") {
              f0to17++;
              f0to17Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "18-25") {
              f18to25++;
              f18to25Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "26-35") {
              f26to35++;
              f26to35Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "36-45") {
              f36to45++;
              f36to45Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "46-50") {
              f46to50++;
              f46to50Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "51-55") {
              f51to55++;
              f51to55Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "55+") {
              f55andup++;
              f55andupPurchase += parseInt(d['Purchase']);
            }
          } else if (d['Gender'] == "M") {
            males++;
            if (d['Age'] == "0-17") {
              m0to17++;
              m0to17Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "18-25") {
              m18to25++;
              m18to25Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "26-35") {
              m26to35++;
              m26to35Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "36-45") {
              m36to45++;
              m36to45Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "46-50") {
              m46to50++;
              m46to50Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "51-55") {
              m51to55++;
              m51to55Purchase += parseInt(d['Purchase']);
            } else if (d['Age'] == "55+") {
              m55andup++;
              m55andupPurchase += parseInt(d['Purchase']);
            }
          }
        });

        // calculating percentages
        var f0to17Percent = (f0to17 / females).toFixed(2);
        var f18to25Percent = (f18to25 / females).toFixed(2);
        var f26to35Percent = (f26to35 / females).toFixed(2);
        var f36to45Percent = (f36to45 / females).toFixed(2);
        var f46to50Percent = (f46to50 / females).toFixed(2);
        var f51to55Percent = (f51to55 / females).toFixed(2);
        var f55andupPercent = (f55andup / females).toFixed(2);

        var m0to17Percent = (m0to17 / males).toFixed(2);
        var m18to25Percent = (m18to25 / males).toFixed(2);
        var m26to35Percent = (m26to35 / males).toFixed(2);
        var m36to45Percent = (m36to45 / males).toFixed(2);
        var m46to50Percent = (m46to50 / males).toFixed(2);
        var m51to55Percent = (m51to55 / males).toFixed(2);
        var m55andupPercent = (m55andup / males).toFixed(2);

        let mPurchaseData = [
          m0to17Purchase, m18to25Purchase, m26to35Purchase, m36to45Purchase,
          m46to50Purchase, m51to55Purchase, m55andupPurchase
        ];
        let minMale = d3.min(mPurchaseData);
        let maxMale = d3.max(mPurchaseData);

        var mScale = d3.scaleLinear()
          .domain([minMale, maxMale])
          .range([1, 3]);

        // outputting results
        console.log("females =", females);
        console.log("females17 =", f0to17, f0to17Percent, f0to17Purchase);
        console.log("females18 =", f18to25, f18to25Percent, f18to25Purchase);
        console.log("females26 =", f26to35, f26to35Percent, f26to35Purchase);
        console.log("females36 =", f36to45, f36to45Percent, f36to45Purchase);
        console.log("females46 =", f46to50, f46to50Percent, f46to50Purchase);
        console.log("females51 =", f51to55, f51to55Percent, f51to55Purchase);
        console.log("females55 =", f55andup, f55andupPercent, f55andupPurchase);

        console.log("males =", males);
        console.log("males17 =", m0to17, m0to17Percent, m0to17Purchase);
        console.log("males18 =", m18to25, m18to25Percent, m18to25Purchase);
        console.log("males26 =", m26to35, m26to35Percent, m26to35Purchase);
        console.log("males36 =", m36to45, m36to45Percent, m36to45Purchase);
        console.log("males46 =", m46to50, m46to50Percent, m46to50Purchase);
        console.log("males51 =", m51to55, m51to55Percent, m51to55Purchase);
        console.log("males55 =", m55andup, m55andupPercent, m55andupPurchase);

        // APRILS PART
        // svg backbone
        let svg = d3.select("#vis1");
        let width = svg.attr("width");
        let height = svg.attr("height");
        let margin = { top: 50, right: 50, bottom: 50, left: 50 };
        let chartWidth = width - margin.left - margin.right;
        let chartHeight = height - margin.top - margin.bottom;

        let svgGirl = d3.select("#pplgirl");
        var g2 = svgGirl.append("g");
        var girlColor = "#ffe6e6";

        // drawing svg girl in d3
        // head
        g2.append("circle")
          .attr("r", 38)
          .attr("cx", 81)
          .attr("cy", 60.5)
          .style("fill", girlColor);

        // leg 1
        g2.append("rect")
          .attr("x", 47)
          .attr("y", 202)
          .attr("width", 28)
          .attr("height", 66)
          .attr("rx", 14)
          .style("fill", girlColor);

        // leg 2
        g2.append("rect")
          .attr("x", 89)
          .attr("y", 202)
          .attr("width", 28)
          .attr("height", 66)
          .attr("rx", 14)
          .style("fill", girlColor);

        // arm 1
        g2.append("rect")
          .attr("x", 78)
          .attr("y", 121)
          .attr("width", 86)
          .attr("height", 23)
          .attr("transform", "rotate(" + 30.0 + "," + 121 + "," + 135 + ")")
          .attr("rx", 11.5)
          .style("fill", girlColor);

        // arm 2
        g2.append("rect")
          .attr("x", 0)
          .attr("y", 119)
          .attr("width", 86)
          .attr("height", 23)
          .attr("transform", "rotate(" + -30.0 + "," + 43 + "," + 130.5 + ")")
          .attr("rx", 11.5)
          .style("fill", girlColor);

        // body
        var bodyData = [
          { "x": 81.1212408, "y": 74 }, { "x": 116.483472, "y": 132.596679 },
          { "x": 135.650022, "y": 174.392624 }, { "x": 138.620892, "y": 199.387835 },
          { "x": 142.809005, "y": 234.624229 }, { "x": 21.1872481, "y": 233.371049 },
          { "x": 23.6215894, "y": 199.387835 }, { "x": 25.4867643, "y": 173.350141 },
          { "x": 44.6533147, "y": 131.554196 }, { "x": 81.1212408, "y": 74 }
        ];

        var bodyLine = d3.line()
          .x(d => d.x)
          .y(d => d.y)
          .curve(d3.curveBasis);

        g2.append("path")
          .attr("d", bodyLine(bodyData))
          .style("fill", girlColor);

        // hair
        var hairData = [
          { "x": 23.4085737, "y": 57.5528923 }, { "x": 27.4855021, "y": 57.5528923 },
          { "x": 36.0329005, "y": 57.364705 }, { "x": 42.7104511, "y": 49.0840613 },
          { "x": 48.1730492, "y": 42.3100463 }, { "x": 52.0455584, "y": 30.9361408 },
          { "x": 54.0264855, "y": 28.8393648 }, { "x": 57.4968188, "y": 25.166079 },
          { "x": 81, "y": 34.3379489 }, { "x": 81, "y": 29.1813797 },
          { "x": 81, "y": 17.4832267 }, { "x": 67.2813195, "y": 0.125837351 },
          { "x": 54.0264855, "y": 0.125837351 }, { "x": 40.7716515, "y": 0.125837351 },
          { "x": 28.1392098, "y": 8.80580904 }, { "x": 28.1392098, "y": 20.503962 },
          { "x": 28.1392098, "y": 24.9201247 }, { "x": 31.439328, "y": 42.5163424 },
          { "x": 28.1392098, "y": 45.3745369 }, { "x": 21.0384739, "y": 51.5244028 },
          { "x": 15.1575641, "y": 57.5528923 }, { "x": 23.4085737, "y": 57.5528923 },
        ];

        g2.append("path")
          .attr("d", bodyLine(hairData)) // uses same curve basis as body
          .style("fill", "#ff9999");

        svgGirl.attr("transform", "translate(750, 100)");

        // female rectangle bar
        let girlScale = d3.select("#gScale");
        var gScale = girlScale.append("g");

        gScale.append("rect")
          .attr("y", -110)
          .attr("width", 100)
          .attr("height", 600)
          .style("fill", girlColor);

        let fPercentData = [
          f0to17Percent, f18to25Percent, f26to35Percent, f36to45Percent,
          f46to50Percent, f51to55Percent, f55andupPercent
        ];

        var colorPercentages = {
          0: "#990000",
          1: "#cc0000",
          2: "#ff1a1a",
          3: "#ff4d4d",
          4: "#ff8080",
          5: "#ffb3b3",
          6: "#ffe6e6"
        };

        var fScale = d3.scaleLinear()
          .domain([0, 1])
          .range([1, 600]);

        var lastY = 0;
        fPercentData.forEach(function(d, i) {
          console.log("last y =", fScale(d));
          gScale.append("rect")
            .attr("y", (-110+lastY))
            .attr("width", 100)
            .attr("height", fScale(d))
            .style("fill", colorPercentages[i])

          lastY += fScale(d);
        });

        girlScale.attr("transform", "translate(850, 100)");

        // drawing svg boy
        let svgBoy = d3.select("#pplboy");
        var g1 = svgBoy.append("g");

        var boyColor = "#e6f9ff";
        // head
        g1.append("circle")
          .attr("r", 38)
          .attr("cx", 81)
          .attr("cy", 50.5)
          .style("fill", boyColor)

        // leg 1
        g1.append("rect")
          .attr("x", 45)
          .attr("y", 192)
          .attr("width", 28)
          .attr("height", 66)
          .attr("rx", 14)
          .style("fill", boyColor);

        // leg 2
        g1.append("rect")
          .attr("x", 87)
          .attr("y", 192)
          .attr("width", 28)
          .attr("height", 66)
          .attr("rx", 14)
          .style("fill", boyColor);

        // arm 1
        g1.append("rect")
          .attr("x", 78)
          .attr("y", 111)
          .attr("width", 86)
          .attr("height", 23)
          .attr("transform", "rotate(" + 30.0 + "," + 121 + "," + 135 + ")")
          .attr("rx", 11.5)
          .style("fill", boyColor);

        // arm 2
        g1.append("rect")
          .attr("x", 0)
          .attr("y", 111)
          .attr("width", 86)
          .attr("height", 23)
          .attr("transform", "rotate(" + -30.0 + "," + 43 + "," + 130.5 + ")")
          .attr("rx", 11.5)
          .style("fill", boyColor);

        // body
        g1.append("rect")
          .attr("x", 37)
          .attr("y", 88)
          .attr("width", 86)
          .attr("height", 126)
          .attr("rx", 20)
          .style("fill", boyColor);

        // hair
        var boyHairData = [
          { "x": 261.935243, "y": 386.335688 }, { "x": 271.393381, "y": 387.621459 },
          { "x": 277.081634, "y": 389.303261 }, { "x": 279, "y": 391.381094 },
          { "x": 280.269172, "y": 392.755768 }, { "x": 283.584756, "y": 397.380817 },
          { "x": 281.49979, "y": 402.369565 }, { "x": 280.788803, "y": 404.070761 },
          { "x": 278.042369, "y": 406.614239 }, { "x": 273.26049, "y": 410 },
          { "x": 263.659038, "y": 412.957294 }, { "x": 256.099331, "y": 414.43594 },
          { "x": 250.58137, "y": 414.43594 }, { "x": 245.06341, "y": 414.43594 },
          { "x": 236.202953, "y": 412.957294 }, { "x": 224, "y": 410 },
          { "x": 233.220013, "y": 404.476628 }, { "x": 239.786415, "y": 399.910949 },
          { "x": 243.699204, "y": 396.302961 }, { "x": 247.611994, "y": 392.694973 },
          { "x": 253.690673, "y": 389.372549 }, { "x": 261.935243, "y": 386.335688 }
        ];

        var hairLine = d3.line()
          .x(d => d.x)
          .y(d => d.y)
          .curve(d3.curveBasis);

        g1.append("path")
          .attr("d", hairLine(boyHairData))
          .attr("transform", "translate(-189.000000, -386.000000)")
          .style("fill", "#99c2ff");

        svgBoy.attr("transform", "translate(-150, 100)");

        // KELLYS PART

        // svg backbone
        let svg2 = d3.select("#vis2");
        let width2 = svg2.attr("width");
        let height2 = svg2.attr("height");
        let margin2 = { top: 50, right: 50, bottom: 50, left: 50 };
        let chartWidth2 = width2 - margin2.left - margin2.right;
        let chartHeight2 = height2 - margin2.top - margin2.bottom;

        // Title
        svg2.append("text")
          .attr("x", 200)
          .attr("y", 30)
          .text("Amount Spent on Purchases, Years Lived in City, and Marital Status")
          .attr("class", "title")

        // Scales
        let maxYears = d3.max(blackFridayData1, function (d) {
          return Math.max(d['Stay_In_Current_City_Years']);
        });
        let yearScale = d3.scalePoint()
          .domain(["0", "1", "2", "3", "4+"])
          .range([20, chartWidth2]);
        let maxPurchase = d3.max(blackFridayData1, function (d) {
          return Math.max(d['Purchase']);
        });
        let purchasesScale = d3.scaleLinear()
          .domain([0, maxPurchase])
          .range([chartHeight2, 0]);
        let colorScale = ["blue", "red"];
        let maritalScale = d3.scaleOrdinal(colorScale);

        // X and Y axes
        let xAxis = d3.axisBottom()
          .scale(yearScale);
        let yAxis = d3.axisLeft()
          .ticks(10, d3.format("$"))
          .scale(purchasesScale);
        svg2.append("g")
          .attr("transform", "translate(" + margin2.left + "," + (margin2.top + chartHeight2) + ")")
          .call(xAxis)
          .style("font-size", "8");
        svg2.append("g")
          .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")")
          .call(yAxis)
          .style("font-size", "8");

        // Draw the circles
        let plot = svg2.append("g")
          .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

        // data1.forEach((d, i) => {
        //   let year = yearScale(d['Stay_In_Current_City_Years']);
        //   let purchase = purchasesScale(d['Purchase']);
        //   let marital = maritalScale(d['Marital_Status']);
        //   let circle = plot.append("circle")
        //     .attr("cx", year)
        //     .attr("cy", purchase)
        //     .attr("r", 5)
        //     .style("fill", marital)
        //     .attr("opacity", 0.7)
        // });

        // KENNY'S PART
      })
    })
      .catch((err) => {
        throw new Error("Something went wrong", err);
      });
  </script>
</body>

</html>
